name: Get pcb2gcode via Conda (Stable)

on: 
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Conda
        uses: conda-incubator/setup-miniconda@v3
        with:
          auto-update-conda: true
          channels: conda-forge
          python-version: "3.10"

      - name: Install pcb2gcode
        shell: pwsh
        run: |
          conda install -c conda-forge pcb2gcode --yes
          
      - name: Collect Binary and DLLs
        shell: pwsh
        run: |
          mkdir dist
          # In der Standard-Conda-Umgebung liegen die Files hier:
          $CONDA_BIN = "$env:CONDA\Library\bin"
          cp "$CONDA_BIN\pcb2gcode.exe" dist/
          # Wir kopieren alle DLLs, um sicherzugehen, dass das Paket standalone l√§uft
          cp "$CONDA_BIN\*.dll" dist/
          
      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: pcb2gcode-windows-standalone
          path: dist/